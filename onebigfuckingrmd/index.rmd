---
title: "One big fucking rmarkdown"
author: "chainsawriot"
output:
  html_document:
    toc: true # table of content true
    depth: 3  # upto three depths of headings (specified by #, ## and ###)
    highlight: tango  # specifies the syntax highlighting style
    toc_float: true
---

# Code reading 的好處和原來 R 有 hash table 

28-December-2016 @chainsawriot

如果你已覺得自己用 R 已用得「不錯」，其實代表你還有很多東西仍未探索。到了這個位置，其實讀書已沒有甚麼作用，更合理的做法是去讀 source code 自行探索。最近與幾個朋友在讀 source code ，才發現我的 R 知識其實甚低。確認無知是智慧的開端，一群人讀 source 可以相互發問，學習效果不錯。只是讀一小段，已學到很多前所未見的 R 。

以下是第一件在閱讀 `magrittr` 的 [pipe](https://github.com/tidyverse/magrittr/blob/master/R/pipe.R) 時發現的第一件事，就是 R 原來有 hash table 。

一直以為 R 只有 list ，但 R 的 list 之 name (key) 沒有 hash ，所以 lookup 時是要從所有的 names 找出你想要的 name ，如果用 big-o notation ，這就是 O(n) 。

```{r list}
x <- list()
x[['hello']] <- 'is me'
x[['hello']]
```

但真的 hash table ，其 key 是有 hash ，故此每次做 lookup ，應該只會是 O(1) 。各大 Scripting langage 都有 hash ，如 Python 的 dict 和 Ruby 的 hash 。一直以為 R 是沒有的，原來是有，皆因其 constructor 竟然叫做 `new.env()` 。

```{r hash_table}
x <- new.env(hash = TRUE)
x[['hello']] <- 'is me'
x[['hello']]
```

其實那東西不是用來建立 hash table 的，是建立一個 environment 。但事實上不少 package 也濫用來作 hash table 之用。

Hadley Wickham 在 Twitter [提醒我](https://twitter.com/hadleywickham/status/813779043854057472)，最好在建立 `new.env` 時要選 parent = emptyenv() 。

